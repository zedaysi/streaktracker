<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Streak Tracker</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,sans-serif;background:linear-gradient(to bottom right,#eff6ff,#e0e7ff);min-height:100vh;padding:1rem}
.container{max-width:48rem;margin:0 auto}
.card{background:#fff;border-radius:.5rem;box-shadow:0 4px 6px rgba(0,0,0,.1);padding:1.5rem;margin-bottom:1rem}
h1{font-size:1.875rem;color:#1f2937;margin-bottom:.5rem}
h2{font-size:1.5rem;color:#1f2937;margin-bottom:1rem}
h3{font-size:1.125rem;color:#1f2937}
.btn-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-bottom:1rem}
.btn{padding:1rem;border:none;border-radius:.5rem;font-weight:600;cursor:pointer}
.btn-primary{background:#4f46e5;color:#fff}
.btn-success{background:#10b981;color:#fff}
.btn-purple{background:#9333ea;color:#fff}
.btn-gray{background:#6b7280;color:#fff}
.btn-secondary{background:#e5e7eb;color:#374151}
.btn-saved{background:#d1d5db;color:#6b7280}
.input,.select{width:100%;padding:.75rem;border:2px solid #e5e7eb;border-radius:.5rem;margin-bottom:1rem}
.label{display:block;font-size:.875rem;font-weight:500;color:#374151;margin-bottom:.5rem}
.activity-card{background:#fff;border-radius:.5rem;box-shadow:0 4px 6px rgba(0,0,0,.1);padding:1rem;margin-bottom:.75rem}
.activity-header{display:flex;justify-content:space-between;margin-bottom:.75rem}
.activity-meta{display:flex;flex-wrap:wrap;gap:.5rem;font-size:.875rem;color:#6b7280;margin-top:.5rem}
.badge{background:#f3f4f6;padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem}
.days-left{font-size:.75rem;color:#ea580c;font-weight:500;margin-top:.25rem}
.delete-btn{background:none;border:none;color:#9ca3af;cursor:pointer;font-size:1.25rem}
.delete-btn:hover{color:#ef4444}
.activity-controls{display:flex;gap:.75rem}
.activity-controls>div{flex:1}
.hidden{display:none!important}
.empty{text-align:center;color:#6b7280;padding:2rem}
.info-box{padding:1rem;border:2px solid;border-radius:.5rem;margin-bottom:1rem}
.info-blue{background:#eff6ff;border-color:#bfdbfe}
.info-green{background:#f0fdf4;border-color:#bbf7d0}
</style>
</head>
<body>
<div class="container">
<div id="main">
<div class="card"><h1>Streak Tracker</h1><p>Build habits, break records, track streaks</p></div>
<div class="btn-grid">
<button class="btn btn-primary" onclick="view('add')">Add</button>
<button class="btn btn-success" onclick="view('graphs')">Graphs</button>
<button class="btn btn-purple" onclick="view('history')">History</button>
<button class="btn btn-gray" onclick="view('backup')">Backup</button>
</div>
<div id="list"></div>
</div>
<div id="add" class="hidden">
<div class="card">
<h2>Add Activity</h2>
<label class="label">Name</label>
<input id="name" class="input">
<label class="label">Type</label>
<select id="type" class="select" onchange="updateForm()">
<option value="cumulative">Cumulative</option>
<option value="positive-habit">Positive Habit</option>
<option value="days-since">Days Since</option>
</select>
<div id="freqOpt" class="hidden">
<label class="label">Frequency</label>
<select id="freq" class="select" onchange="updateForm()">
<option value="daily">Daily</option>
<option value="weekly">Weekly</option>
<option value="monthly">Monthly</option>
</select>
<div id="freqTypeOpt" class="hidden">
<label class="label">Period</label>
<select id="freqType" class="select"></select>
</div>
</div>
<div style="display:flex;gap:.75rem">
<button class="btn btn-primary" style="flex:1" onclick="addAct()">Add</button>
<button class="btn btn-secondary" style="flex:1" onclick="view('main')">Cancel</button>
</div>
</div>
</div>
<div id="graphs" class="hidden">
<div class="card">
<div style="display:flex;justify-content:space-between;margin-bottom:1rem">
<h2 style="margin:0">Graphs</h2>
<button class="delete-btn" onclick="view('main')">✕</button>
</div>
<div id="gSel"></div>
<div id="gDisp" class="hidden">
<div style="display:flex;justify-content:space-between;margin-bottom:1rem">
<h3 id="gTitle"></h3>
<button class="btn btn-secondary" onclick="deselG()">Back</button>
</div>
<div style="display:flex;gap:.5rem;margin-bottom:1rem">
<button class="btn btn-secondary" style="flex:1" onclick="setPeriod('week')">Week</button>
<button class="btn btn-secondary" style="flex:1" onclick="setPeriod('month')">Month</button>
<button class="btn btn-secondary" style="flex:1" onclick="setPeriod('year')">Year</button>
<button class="btn btn-secondary" style="flex:1" onclick="setPeriod('all')">All</button>
</div>
<canvas id="chart"></canvas>
</div>
</div>
</div>
<div id="history" class="hidden">
<div class="card">
<div style="display:flex;justify-content:space-between;margin-bottom:1rem">
<h2 style="margin:0">History</h2>
<button class="delete-btn" onclick="view('main')">✕</button>
</div>
<div id="hList"></div>
</div>
</div>
<div id="backup" class="hidden">
<div class="card">
<div style="display:flex;justify-content:space-between;margin-bottom:1rem">
<h2 style="margin:0">Backup</h2>
<button class="delete-btn" onclick="view('main')">✕</button>
</div>
<div class="info-box info-blue">
<h3 style="color:#1e3a8a;margin-bottom:.5rem">Export</h3>
<p style="font-size:.875rem;color:#1e40af;margin-bottom:.75rem">Copies to clipboard</p>
<button class="btn" style="background:#2563eb;color:#fff;width:100%" onclick="exportData()">Copy</button>
</div>
<div class="info-box info-green">
<h3 style="color:#065f46;margin-bottom:.5rem">Import</h3>
<p style="font-size:.875rem;color:#047857;margin-bottom:.75rem">Restore from file</p>
<input type="file" id="impFile" accept=".json" style="display:none">
<button class="btn" style="background:#059669;color:#fff;width:100%" onclick="document.getElementById('impFile').click()">Choose File</button>
</div>
</div>
</div>
</div>
<script>
var acts=[],selAct=null,period='week',chart=null;
function init(){
var stored=localStorage.getItem('acts');
if(stored)acts=JSON.parse(stored);
render();
document.getElementById('impFile').addEventListener('change',function(e){
var f=e.target.files[0];
if(!f)return;
var r=new FileReader();
r.onload=function(ev){
try{acts=JSON.parse(ev.target.result);save();alert('Imported!');view('main');}catch(e){alert('Error importing');}
};
r.readAsText(f);
});
}
function save(){localStorage.setItem('acts',JSON.stringify(acts));render();}
function view(v){
['main','add','graphs','history','backup'].forEach(function(x){document.getElementById(x).classList.add('hidden');});
document.getElementById(v).classList.remove('hidden');
if(v==='graphs')renderGSel();
if(v==='history')renderHist();
}
function updateForm(){
var t=document.getElementById('type').value;
var f=document.getElementById('freq').value;
var fOpt=document.getElementById('freqOpt');
var fTOpt=document.getElementById('freqTypeOpt');
var fTSel=document.getElementById('freqType');
if(t==='positive-habit'||t==='days-since'){
fOpt.classList.remove('hidden');
if(f!=='daily'){
fTOpt.classList.remove('hidden');
fTSel.innerHTML=f==='weekly'?'<option value="calendar">Once per week</option><option value="rolling">Within 7 days</option>':'<option value="calendar">Once per month</option><option value="rolling">Within 30 days</option>';
}else{fTOpt.classList.add('hidden');}
}else{fOpt.classList.add('hidden');}
}
function addAct(){
var n=document.getElementById('name').value.trim();
if(!n)return;
var t=document.getElementById('type').value;
var f=(t==='positive-habit'||t==='days-since')?document.getElementById('freq').value:'daily';
var ft=f!=='daily'?document.getElementById('freqType').value:'calendar';
acts.push({id:Date.now().toString(),name:n,type:t,frequency:f,frequencyType:ft,entries:[],streaks:[]});
document.getElementById('name').value='';
save();view('main');
}
function saveEnt(id,val){
var today=new Date().toISOString().split('T')[0];
var a=acts.find(function(x){return x.id===id;});
if(!a)return;
var idx=a.entries.findIndex(function(e){return e.date===today;});
if(idx>=0)a.entries[idx].value=val;
else a.entries.push({date:today,value:val});
a.streaks=calcStreaks(a.entries,a.type,a.frequency);
save();
}
function calcStreaks(ents,type,freq){
if(!ents.length)return[];
var sorted=ents.slice().sort(function(a,b){return new Date(a.date)-new Date(b.date);});
var streaks=[],cur={start:sorted[0].date,end:sorted[0].date,entries:[sorted[0]]};
for(var i=1;i<sorted.length;i++){
var diff=(new Date(sorted[i].date)-new Date(sorted[i-1].date))/86400000;
var broke=(type==='days-since'||type==='positive-habit')&&(sorted[i].value==='reset'||sorted[i].value==='missed');
if(broke||(freq==='daily'&&diff>1)){streaks.push(cur);cur={start:sorted[i].date,end:sorted[i].date,entries:[sorted[i]]};}
else if(freq==='daily'&&diff===1){cur.end=sorted[i].date;cur.entries.push(sorted[i]);}
else if(freq!=='daily'){cur.end=sorted[i].date;cur.entries.push(sorted[i]);}
}
streaks.push(cur);return streaks;
}
function getStreak(a){
if(!a.streaks.length)return 0;
var last=a.streaks[a.streaks.length-1];
var lastVal=last.entries[last.entries.length-1];
if(lastVal&&(lastVal.value==='reset'||lastVal.value==='missed'))return 0;
if(a.frequency==='daily'){
var today=new Date().toISOString().split('T')[0];
var yest=new Date(Date.now()-86400000).toISOString().split('T')[0];
if(last.end===today||last.end===yest)return last.entries.filter(function(e){return e.value!=='reset'&&e.value!=='missed';}).length;
}
return 0;
}
function getDaysLeft(a){
var freq=a.frequency||'daily';
if(freq==='daily')return null;
var today=new Date();
var ft=a.frequencyType||'calendar';
if(freq==='weekly'){
if(ft==='calendar'){var day=today.getDay();return day===0?1:8-day;}
if(a.entries.length){
var sorted=a.entries.slice().sort(function(x,y){return new Date(y.date)-new Date(x.date);});
var last=new Date(sorted[0].date);
return Math.max(0,7-Math.floor((today-last)/86400000));
}
return 7;
}
if(freq==='monthly'){
if(ft==='calendar')return new Date(today.getFullYear(),today.getMonth()+1,0).getDate()-today.getDate()+1;
if(a.entries.length){
var sorted=a.entries.slice().sort(function(x,y){return new Date(y.date)-new Date(x.date);});
var last=new Date(sorted[0].date);
return Math.max(0,30-Math.floor((today-last)/86400000));
}
return 30;
}
return null;
}
function getLastVal(a){
if(!a.entries.length)return a.type==='cumulative'?0:null;
var sorted=a.entries.slice().sort(function(x,y){return new Date(y.date)-new Date(x.date);});
return sorted[0].value;
}
function delAct(id){acts=acts.filter(function(a){return a.id!==id;});save();}
function getFreqLabel(a){
var freq=a.frequency||'daily';
if(freq==='daily')return'Daily';
var ft=a.frequencyType||'calendar';
if(freq==='weekly')return ft==='calendar'?'Weekly (Mon-Sun)':'Within 7 days';
if(freq==='monthly')return ft==='calendar'?'Monthly':'Within 30 days';
return'';
}
function render(){
var list=document.getElementById('list');
if(!acts.length){list.innerHTML='<div class="card empty">No activities yet</div>';return;}
var html='',today=new Date().toISOString().split('T')[0];
for(var i=0;i<acts.length;i++){
var a=acts[i],lastVal=getLastVal(a),streak=getStreak(a),daysLeft=getDaysLeft(a);
var saved=a.entries.some(function(e){return e.date===today;});
var selHTML='';
if(a.type==='cumulative'){
selHTML='<select class="select" id="val-'+a.id+'" style="margin:0;padding:.75rem;font-size:1.125rem;font-weight:600">';
for(var n=0;n<=200;n++)selHTML+='<option value="'+n+'"'+(n===(lastVal||0)?' selected':'')+'>'+n+'</option>';
selHTML+='</select>';
}else if(a.type==='days-since'){
selHTML='<select class="select" id="val-'+a.id+'" style="margin:0;padding:.75rem;font-size:1.125rem;font-weight:600"><option value="kept">Kept it going ✓</option><option value="reset">Reset streak ✗</option></select>';
}else{
selHTML='<select class="select" id="val-'+a.id+'" style="margin:0;padding:.75rem;font-size:1.125rem;font-weight:600"><option value="did">Did it ✓</option><option value="missed">Missed it ✗</option></select>';
}
html+='<div class="activity-card"><div class="activity-header"><div style="flex:1"><h3>'+a.name+'</h3><div class="activity-meta"><span>Streak: '+streak+' '+(a.frequency==='daily'?'days':'periods')+'</span>';
if(a.type==='cumulative'&&lastVal>0)html+='<span>Last: '+lastVal+'</span>';
html+='<span class="badge">'+getFreqLabel(a)+'</span></div>';
if(daysLeft!==null)html+='<div class="days-left">'+daysLeft+' '+(daysLeft===1?'day':'days')+' left</div>';
html+='</div><button class="delete-btn" onclick="delAct(\''+a.id+'\')">✕</button></div>';
html+='<div class="activity-controls"><div>'+selHTML+'</div>';
html+='<button class="btn '+(saved?'btn-saved':'btn-primary')+'" onclick="saveEnt(\''+a.id+'\',document.getElementById(\'val-'+a.id+'\').value)" style="padding:.75rem 1.5rem">'+(saved?'Saved':'Save')+'</button></div></div>';
}
list.innerHTML=html;
}
function renderGSel(){
var cum=acts.filter(function(a){return a.type==='cumulative';});
var sel=document.getElementById('gSel');
if(!cum.length){sel.innerHTML='<p class="empty">No cumulative activities</p>';document.getElementById('gDisp').classList.add('hidden');return;}
var html='<p style="color:#6b7280;margin-bottom:.75rem">Select activity:</p>';
for(var i=0;i<cum.length;i++)html+='<button class="activity-card" onclick="selG(\''+cum[i].id+'\')" style="cursor:pointer"><strong>'+cum[i].name+'</strong></button>';
sel.innerHTML=html;
}
function selG(id){
selAct=acts.find(function(a){return a.id===id;});
document.getElementById('gSel').classList.add('hidden');
document.getElementById('gDisp').classList.remove('hidden');
document.getElementById('gTitle').textContent=selAct.name;
renderG();
}
function deselG(){
selAct=null;
document.getElementById('gSel').classList.remove('hidden');
document.getElementById('gDisp').classList.add('hidden');
if(chart)chart.destroy();
}
function setPeriod(p){period=p;renderG();}
function renderG(){
if(!selAct)return;
var now=Date.now();
var starts={week:now-7*86400000,month:now-30*86400000,year:now-365*86400000,all:0};
var data=selAct.entries.filter(function(e){return new Date(e.date)>=starts[period];}).sort(function(a,b){return new Date(a.date)-new Date(b.date);});
var labels=[],values=[];
for(var i=0;i<data.length;i++){
labels.push(new Date(data[i].date).toLocaleDateString('en-US',{month:'short',day:'numeric'}));
values.push(data[i].value);
}
var ctx=document.getElementById('chart').getContext('2d');
if(chart)chart.destroy();
chart=new Chart(ctx,{type:'line',data:{labels:labels,datasets:[{label:selAct.name,data:values,borderColor:'#4f46e5',backgroundColor:'rgba(79,70,229,0.1)',tension:0.1}]},options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{display:false}}}});
}
function renderHist(){
var streaks=[];
for(var i=0;i<acts.length;i++){
var a=acts[i];
for(var j=0;j<a.streaks.length;j++){
var s=a.streaks[j],len=0,peak=0;
for(var k=0;k<s.entries.length;k++){
if(s.entries[k].value!=='reset'&&s.entries[k].value!=='missed')len++;
if(a.type==='cumulative'&&s.entries[k].value>peak)peak=s.entries[k].value;
}
var ongoing=s.end===a.streaks[a.streaks.length-1].end&&getStreak(a)>0;
streaks.push({name:a.name,type:a.type,len:len,end:s.end,peak:peak>0?peak:null,latest:s.entries[s.entries.length-1]?s.entries[s.entries.length-1].value:null,ongoing:ongoing});
}
}
streaks.sort(function(a,b){return new Date(b.end)-new Date(a.end);});
var list=document.getElementById('hList');
if(!streaks.length){list.innerHTML='<p class="empty">No streaks yet</p>';return;}
var html='';
for(var i=0;i<streaks.length;i++){
var s=streaks[i];
html+='<div style="background:#f9fafb;border:2px solid #e5e7eb;border-radius:.5rem;padding:1rem;margin-bottom:.75rem"><div style="display:flex;justify-content:space-between"><div style="flex:1"><h3>'+s.name+'</h3>';
html+='<p style="font-size:.875rem;color:#6b7280;margin-top:.25rem"><strong>'+s.len+' '+(s.len===1?'day':'days')+'</strong>';
if(s.type==='cumulative'&&s.peak)html+=', peak = '+s.peak;
if(s.type==='cumulative'&&s.ongoing&&s.latest)html+=', latest = '+s.latest;
html+='</p><p style="font-size:.75rem;color:#9ca3af;margin-top:.25rem">';
html+=s.ongoing?'<span style="color:#059669;font-weight:500">Ongoing</span>':'Ended '+new Date(s.end).toLocaleDateString('en-US',{day:'numeric',month:'short',year:'numeric'});
html+='</p></div>';
if(s.ongoing)html+='<span style="background:#d1fae5;color:#065f46;padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem;font-weight:600">Active</span>';
html+='</div></div>';
}
list.innerHTML=html;
}
function exportData(){
var str=JSON.stringify(acts,null,2);
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(str).then(function(){alert('Copied to clipboard!');}).catch(function(){downloadBackup(str);});
}else{downloadBackup(str);}
}
function downloadBackup(str){
var blob=new Blob([str],{type:'application/json'});
var url=URL.createObjectURL(blob);
var link=document.createElement('a');
link.href=url;
link.download='streak-backup-'+new Date().toISOString().split('T')[0]+'.json';
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
URL.revokeObjectURL(url);
}
init();
</script>
</body>
</html>
